<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>自定义滚动条</title>
<style>
*{ margin:0; padding:0}
body{ height:3000px;background: #fff;}
.box{ width:300px; height:400px; border:1px solid #ccc; margin:100px auto; position:relative;overflow:hidden;}
h4{height:60px; line-height:60px;}
.box .scroll{ height:50px; width:20px; background:#ccc; position:absolute; top:0; right:0; cursor:pointer}
.box_cont{ margin-right:30px; position:absolute; top:0; left:0}


</style>
<script src="../js/jquery-1.11.3.min.js"></script>
<script src="hxsd_plugin.js"></script>
<script>

$(function(){
	//判断内容部分的高度是否溢出
	var box1=$('#box1');
	var cont_h=box1.prop("scrollHeight");
	
	console.log(cont_h)
	var box_h=box1.height();
	
	if(cont_h>box_h){
		box1.children().wrap('<div class="box_cont"></div>');
		var scroller=$('<div class="scroll"></div>');//创建滚动条手柄 对象
		
		var new_cont_h=box1.prop("scrollHeight"); //包裹以后，要重新计算内容的高度
		console.log(new_cont_h)
		
		var h_rate=box_h/new_cont_h; //计算高度比例
		
		box1.append(scroller);//插入滚动手柄
		
		var scroller_h=box_h*h_rate;//滚动手柄长度
		
		if(scroller_h<50){//限制手柄最小高度
			scroller_h=50;
		}
		scroller.height(scroller_h);
		
		//---------------------------------------------
		scroller.mousedown(function(ev){
			/*
			//偏移计算
			var disY=ev.pageY-scroller.offset().top;
			$(document).mousemove(function(ev){
				console.log(disY)
				var t=ev.pageY-disY-box1.offset().top;
				move(t);
			});
			*/
			
			var disY=ev.pageY-$(this).position().top;
			$(document).mousemove(function(ev){
				var t=ev.pageY-disY;
				move(t);
			});
			
			$(document).mouseup(function(){
				$(document).unbind('mousemove');
			});
			return false;
		});
		
		//-----------------------------------------------------------
		box1.mouseWheel(function(d){
			var t=0;
			if(d){ // ↓
				//console.log(d)
				t=scroller.position().top+10;
				move(t);
			}else{ //↑
				//console.log(d)
				t=scroller.position().top-10;
				move(t);
			}
		});
		
		
	};
	
	
	//滚动内容
	function move(t){
		if(t<0){
			t=0;
		};
		if(t>box_h-scroller_h){
			t=box_h-scroller_h;
		};
		scroller.css("top",t);
		//-------------------------------------
		//移动内容
		var move_rate=t/(box_h-scroller_h);//移动比率
		var tt=(box_h-new_cont_h)*move_rate;
		$('#box1 .box_cont').css("top",tt);
	};
	
	
	

});



</script>


</head>

<body>
<div id="box1" class="box">
	<div>
    <h4>223423n2sdfsdf</h4>
	<p>
言。身为欧洲计算机制造商协会,英文名称是European Computer Manufacturers Association）通过ECMA-262标准化的脚本程序设计语言。
言。  ECMAScript是一种由Ecma国际（前身为欧洲计算机制造商协会,英文名称是European Computer Manufacturers Association）通过ECMA-262标准化的脚本程序设计语言。
。身为欧洲计算机制造商协会,英文名称是European Computer Manufacturers Association）通过ECMA-262标准化的脚本程序设计语言。
言。  ECMAScript是一种由Ecma国际（前身为欧洲计算机制造商协会,英文名称是European Computer Manufacturers Association）通过ECMA-262标准化的脚本程序设计
。身为欧洲计算机制造商协会,英文名称是European Computer Manufacturers Association）通过ECMA-262标准化的脚本程序设计语言。
言。  ECMAScript是一种由Ecma国际（前身为欧洲计算机制造商协会,英文名称是European Computer Manufacturers Association）通过ECMA-262标准化的脚本程序设计
。身为欧洲计算机制造商协会,英文名称是European Computer Manufacturers Association）通过ECMA-262标准化的脚本程序设计语言。
言。  ECMAScript是一种由Ecma国际（前身为欧洲计算机制造商协会,英文名称是European Computer Manufacturers Association）通过ECMA-262标准化的脚本程序设计
。身为欧洲计算机制造商协会,英文名称是European Computer Manufacturers Association）通过ECMA-262标准化的脚本程序设计语言。
言。  ECMAScript是一种由Ecma国际（前身为欧洲计算机制造商协会,英文名称是European Computer Manufacturers Association）通过ECMA-262标准化的脚本程序设计
。身为欧洲计算机制造商协会,英文名称是European Computer Manufacturers Association）通过ECMA-262标准化的脚本程序设计语言。
言。  ECMAScript是一种由Ecma国际（前身为欧洲计算机制造商协会,英文名称是European Computer Manufacturers Association）通过ECMA-262标准化的脚本程序设计
。身为欧洲计算机制造商协会,英文名称是European Computer Manufacturers Association）通过ECMA-262标准化的脚本程序设计语言。
言。  ECMAScript是一种由Ecma国际（前身为欧洲计算机制造商协会,英文名称是European Computer Manufacturers Association）通过ECMA-262标准化的脚本程序设计
。身为欧洲计算机制造商协会,英文名称是European Computer Manufacturers Association）通过ECMA-262标准化的脚本程序设计语言。
言。  ECMAScript是一种由Ecma国际（前身为欧洲计算机制造商协会,英文名称是European Computer Manufacturers Association）通过ECMA-262标准化的脚本程序设计
。身为欧洲计算机制造商协会,英文名称是European Computer Manufacturers Association）通过ECMA-262标准化的脚本程序设计语言。
言。  ECMAScript是一种由Ecma国际（前身为欧洲计算机制造商协会,英文名称是European Computer Manufacturers Association）通过ECMA-262标准化的脚本程序设计
。身为欧洲计算机制造商协会,英文名称是European Computer Manufacturers Association）通过ECMA-262标准化的脚本程序设计语言。
言。  ECMAScript是一种由Ecma国际（前身为欧洲计算机制造商协会,英文名称是European Computer Manufacturers Association）通过ECMA-262标准化的脚本程序设计

 
</p>
    </div>
	
</div>


</body>
</html>
